<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理员工作台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="icon" href="/Anotherview/favicon.ico" type="image/x-icon"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap');

        body {
            font-family: 'Nunito', sans-serif;
            transition: background-color 0.3s ease;
            overflow-x: hidden;
        }

        .transition-all {
            transition: all 0.3s ease-in-out;
        }

        .sidebar-button.active {
            background: linear-gradient(90deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
        }

        .card {
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #3b82f6;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .shimmer {
            background: linear-gradient(to right, #f6f7f8 0%, #edeef1 20%, #f6f7f8 40%, #f6f7f8 100%);
            background-size: 800px 100%;
            animation: shimmer 1.5s infinite linear;
        }

        @keyframes shimmer {
            0% {
                background-position: -800px 0;
            }
            100% {
                background-position: 800px 0;
            }
        }

        .sidebar {
            position: relative;
            transition: width 0.3s ease;
            overflow: hidden;
        }

        .sidebar::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(to bottom, transparent, rgba(59, 130, 246, 0.5), transparent);
            animation: sidebar-glow 3s infinite;
        }

        @keyframes sidebar-glow {
            0% {
                opacity: 0.3;
            }
            50% {
                opacity: 0.7;
            }
            100% {
                opacity: 0.3;
            }
        }

        #personal-info-content .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #e5e7eb;
        }

        #personal-info-content .info-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }

        #personal-info-content .info-item i {
            margin-right: 10px;
            color: #3b82f6;
            font-size: 1.1rem;
        }

        #personal-info-content strong {
            color: #1f2937;
            margin-right: 8px;
        }

        tbody tr {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            opacity: 0;
            transform: translateY(20px);
        }

        tbody tr.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        tbody tr:hover {
            transform: translateX(5px);
            box-shadow: -5px 0 0 #3b82f6;
        }

        .status-active {
            color: #22c55e;
            text-shadow: 0 0 10px rgba(34, 197, 94, 0.3);
        }

        .status-inactive {
            color: #ef4444;
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
        }

        .status-archived {
            color: #6b7280;
            text-shadow: 0 0 10px rgba(107, 114, 128, 0.3);
        }

        .status-easy {
            color: #22c55e;
            text-shadow: 0 0 10px rgba(34, 197, 94, 0.3);
        }

        .status-medium {
            color: #f59e0b;
            text-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
        }

        .status-hard {
            color: #ef4444;
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
        }

        .badge {
            position: relative;
            display: inline-block;
            padding: 4px 10px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            overflow: hidden;
            white-space: nowrap;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans leading-normal tracking-normal">

<header class="bg-white p-4 shadow-lg flex justify-between items-center animate__animated animate__fadeIn">
    <div class="flex items-center">
        <i class="fas fa-user-shield text-blue-600 text-2xl mr-3" aria-hidden="true"></i>
        <h1 class="text-xl font-bold text-gray-800">管理员工作台</h1>
    </div>
    <div class="user-info text-gray-600 flex items-center" role="region" aria-label="用户信息">
        <i class="fas fa-user-circle text-blue-500 mr-2" aria-hidden="true"></i>
        欢迎, <span id="username" class="font-semibold mx-1">加载中...</span> |
        <a href="#" onclick="logout()" class="text-blue-600 hover:text-blue-800 ml-2 transition-all flex items-center"
           role="button">
            <span>退出登录</span>
            <i class="fas fa-sign-out-alt ml-1" aria-hidden="true"></i>
        </a>
    </div>
</header>

<div class="flex min-h-screen">
    <aside class="sidebar w-56 bg-gray-800 text-white p-4" role="navigation"
           aria-label="主导航">
        <div class="sidebar-item mb-6">
            <button class="sidebar-button w-full text-left py-3 px-4 rounded-md transition duration-300 ease-in-out active flex items-center"
                    onclick="navigateTo('dashboard')" aria-current="page">
                <i class="fas fa-tachometer-alt mr-3" aria-hidden="true"></i>
                <span>仪表盘</span>
            </button>
        </div>
        <div class="sidebar-item mb-6">
            <button class="sidebar-button w-full text-left py-3 px-4 rounded-md transition duration-300 ease-in-out flex items-center"
                    onclick="navigateTo('class-management')" aria-current="false">
                <i class="fas fa-chalkboard mr-3" aria-hidden="true"></i>
                <span>班级管理</span>
            </button>
        </div>
        <div class="sidebar-item mb-6">
            <button class="sidebar-button w-full text-left py-3 px-4 rounded-md transition duration-300 ease-in-out flex items-center"
                    onclick="navigateTo('teacher-management')" aria-current="false">
                <i class="fas fa-chalkboard-teacher mr-3" aria-hidden="true"></i>
                <span>教师管理</span>
            </button>
        </div>
        <div class="sidebar-item mb-6">
            <button class="sidebar-button w-full text-left py-3 px-4 rounded-md transition duration-300 ease-in-out flex items-center"
                    onclick="navigateTo('course-management')" aria-current="false">
                <i class="fas fa-book mr-3" aria-hidden="true"></i>
                <span>课程管理</span>
            </button>
        </div>
        <div class="sidebar-item mb-6">
            <button class="sidebar-button w-full text-left py-3 px-4 rounded-md transition duration-300 ease-in-out flex items-center"
                    onclick="navigateTo('student-management')" aria-current="false">
                <i class="fas fa-user-graduate mr-3" aria-hidden="true"></i>
                <span>学生管理</span>
            </button>
        </div>
        <div class="sidebar-item mb-6">
            <button class="sidebar-button w-full text-left py-3 px-4 rounded-md transition duration-300 ease-in-out flex items-center"
                    onclick="navigateTo('question-management')" aria-current="false">
                <i class="fas fa-question-circle mr-3" aria-hidden="true"></i>
                <span>题目管理</span>
            </button>
        </div>
        <div class="sidebar-item mb-6">
            <button class="sidebar-button w-full text-left py-3 px-4 rounded-md transition duration-300 ease-in-out flex items-center"
                    onclick="navigateTo('semester-management')" aria-current="false">
                <i class="fas fa-calendar-alt mr-3" aria-hidden="true"></i>
                <span>学期管理</span>
            </button>
        </div>
        <div class="sidebar-item mb-6">
            <button class="sidebar-button w-full text-left py-3 px-4 rounded-md transition duration-300 ease-in-out flex items-center"
                    onclick="navigateTo('profile')" aria-current="false">
                <i class="fas fa-user mr-3" aria-hidden="true"></i>
                <span>个人信息</span>
            </button>
        </div>
    </aside>

    <main class="content flex-1 p-6 bg-gray-50 animate__animated animate__fadeIn" role="main">
        <section id="dashboard-section" class="card bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 id="dashboard-heading"
                class="text-2xl font-bold mb-6 text-gray-800 border-b pb-4 flex items-center">
                <i class="fas fa-tachometer-alt text-blue-500 mr-3" aria-hidden="true"></i>
                仪表盘
            </h2>
            <div class="text-center py-8 text-gray-500">
                <p>欢迎来到管理员仪表盘！</p>
                <p>您的姓名是：<span class="font-bold text-blue-600" id="dashboard-admin-name"></span></p>
            </div>
        </section>

        <section id="class-management-section" class="card bg-white p-6 rounded-lg shadow-md mb-6"
                 style="display: none;">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-4 flex items-center">
                <i class="fas fa-chalkboard text-blue-500 mr-3" aria-hidden="true"></i>
                <span>班级管理</span>
            </h2>
            <div class="controls mb-6 flex items-end gap-4">
                <button onclick="openAddClassModal()"
                        class="btn bg-green-500 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-300 transition-all flex items-center justify-center h-auto"
                        aria-label="添加班级">
                    <i class="fas fa-plus mr-1" aria-hidden="true"></i>添加班级
                </button>
            </div>
            <div class="overflow-x-auto rounded-lg border border-gray-200 shadow-sm" role="region"
                 aria-labelledby="class-list-heading">
                <h3 id="class-list-heading" class="sr-only">班级列表</h3>
                <table class="min-w-full bg-white">
                    <thead>
                    <tr class="bg-gradient-to-r from-blue-50 to-blue-100 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left" scope="col">班级ID</th>
                        <th class="py-3 px-6 text-left" scope="col">班级名称</th>
                        <th class="py-3 px-6 text-center" scope="col">详情</th>
                    </tr>
                    </thead>
                    <tbody id="class-list" class="text-gray-600 text-sm">
                    </tbody>
                </table>
                <div id="loading-classes-message" class="text-center py-8 text-gray-500" style="display: none;"
                     aria-live="polite">
                    <div class="loader mb-3" role="status" aria-label="加载中"></div>
                    <p>正在加载班级数据...</p>
                </div>
                <div id="no-classes-data-message" class="text-center py-8 text-gray-500" style="display: none;"
                     aria-live="polite">
                    <i class="fas fa-chalkboard-slash text-4xl mb-2 text-gray-300" aria-hidden="true"></i>
                    <p>没有找到班级数据。</p>
                </div>
            </div>
        </section>

        <section id="teacher-management-section" class="card bg-white p-6 rounded-lg shadow-md mb-6"
                 style="display: none;">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-4 flex items-center">
                <i class="fas fa-chalkboard-teacher text-blue-500 mr-3" aria-hidden="true"></i>
                <span>教师管理</span>
            </h2>
            <div class="controls mb-6 flex flex-col sm:flex-row sm:items-end gap-4">
                <div class="flex flex-col flex-grow">
                    <label for="teacher-name-filter"
                           class="block text-gray-700 text-sm font-bold mb-1 flex items-center">
                        <i class="fas fa-filter text-blue-500 mr-2" aria-hidden="true"></i>
                        筛选姓名:
                    </label>
                    <input type="text" id="teacher-name-filter"
                           placeholder="输入教师姓名"
                           class="shadow appearance-none border rounded-lg py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                           aria-label="筛选教师姓名">
                </div>

                <div class="flex flex-col flex-grow">
                    <label for="teacher-email-filter"
                           class="block text-gray-700 text-sm font-bold mb-1 flex items-center">
                        <i class="fas fa-filter text-blue-500 mr-2" aria-hidden="true"></i>
                        筛选邮箱:
                    </label>
                    <input type="email" id="teacher-email-filter"
                           placeholder="输入教师邮箱"
                           class="shadow appearance-none border rounded-lg py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                           aria-label="筛选教师邮箱">
                </div>

                <div class="flex items-end flex-grow relative">
                    <i class="fas fa-search absolute left-3 bottom-2 text-gray-400" aria-hidden="true"></i>
                    <label for="teacher-search-input" class="sr-only">搜索教师</label>
                    <input type="text" id="teacher-search-input"
                           placeholder="搜索教师姓名或邮箱..."
                           class="shadow appearance-none border rounded-lg flex-grow py-2 pl-10 pr-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                           aria-label="搜索教师姓名或邮箱">
                    <button onclick="loadTeachers()"
                            class="btn ml-2 bg-blue-500 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all flex items-center justify-center h-auto"
                            aria-label="搜索">
                        <i class="fas fa-search mr-1" aria-hidden="true"></i>搜索
                    </button>
                </div>
            </div>
            <div class="overflow-x-auto rounded-lg border border-gray-200 shadow-sm" role="region"
                 aria-labelledby="teacher-list-heading">
                <h3 id="teacher-list-heading" class="sr-only">教师列表</h3>
                <table class="min-w-full bg-white">
                    <thead>
                    <tr class="bg-gradient-to-r from-blue-50 to-blue-100 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left" scope="col">教师ID</th>
                        <th class="py-3 px-6 text-left" scope="col">姓名</th>
                        <th class="py-3 px-6 text-left" scope="col">邮箱</th>
                        <th class="py-3 px-6 text-left" scope="col">关联班级</th>
                        <th class="py-3 px-6 text-left" scope="col">操作</th>
                    </tr>
                    </thead>
                    <tbody id="teacher-list" class="text-gray-600 text-sm">
                    </tbody>
                </table>
                <div id="loading-teachers-message" class="text-center py-8 text-gray-500" style="display: none;"
                     aria-live="polite">
                    <div class="loader mb-3" role="status" aria-label="加载中"></div>
                    <p>正在加载教师数据...</p>
                </div>
                <div id="no-teachers-data-message" class="text-center py-8 text-gray-500" style="display: none;"
                     aria-live="polite">
                    <i class="fas fa-users-slash text-4xl mb-2 text-gray-300" aria-hidden="true"></i>
                    <p>没有找到教师数据。</p>
                </div>
            </div>
        </section>

        <section id="course-management-section" class="card bg-white p-6 rounded-lg shadow-md mb-6"
                 style="display: none;">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-4 flex items-center">
                <i class="fas fa-book text-blue-500 mr-3" aria-hidden="true"></i>
                <span>课程管理</span>
            </h2>
            <div class="controls mb-6 flex flex-col sm:flex-row sm:items-end gap-4">
                <button onclick="openAddLessonModal()"
                        class="btn bg-green-500 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-300 transition-all flex items-center justify-center h-auto"
                        aria-label="添加课程">
                    <i class="fas fa-plus mr-1" aria-hidden="true"></i>添加课程
                </button>
                <div class="flex flex-col flex-grow">
                    <label for="lesson-title-filter"
                           class="block text-gray-700 text-sm font-bold mb-1 flex items-center">
                        <i class="fas fa-filter text-blue-500 mr-2" aria-hidden="true"></i>
                        筛选标题:
                    </label>
                    <input type="text" id="lesson-title-filter"
                           placeholder="输入课程标题"
                           class="shadow appearance-none border rounded-lg py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                           aria-label="筛选课程标题">
                </div>

                <div class="flex flex-col flex-grow">
                    <label for="lesson-teacher-filter"
                           class="block text-gray-700 text-sm font-bold mb-1 flex items-center">
                        <i class="fas fa-filter text-blue-500 mr-2" aria-hidden="true"></i>
                        筛选教师:
                    </label>
                    <input type="text" id="lesson-teacher-filter"
                           placeholder="输入教师姓名"
                           class="shadow appearance-none border rounded-lg py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                           aria-label="筛选教师姓名">
                </div>

                <div class="flex flex-col flex-grow">
                    <label for="lesson-semester-filter"
                           class="block text-gray-700 text-sm font-bold mb-1 flex items-center">
                        <i class="fas fa-filter text-blue-500 mr-2" aria-hidden="true"></i>
                        筛选学期:
                    </label>
                    <input type="text" id="lesson-semester-filter"
                           placeholder="输入学期名称"
                           class="shadow appearance-none border rounded-lg py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                           aria-label="筛选学期名称">
                </div>

                <div class="flex items-end flex-grow relative">
                    <i class="fas fa-search absolute left-3 bottom-2 text-gray-400" aria-hidden="true"></i>
                    <label for="lesson-search-input" class="sr-only">搜索课程</label>
                    <input type="text" id="lesson-search-input"
                           placeholder="搜索课程标题或描述..."
                           class="shadow appearance-none border rounded-lg flex-grow py-2 pl-10 pr-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                           aria-label="搜索课程标题或描述">
                    <button onclick="loadLessons()"
                            class="btn ml-2 bg-blue-500 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all flex items-center justify-center h-auto"
                            aria-label="搜索">
                        <i class="fas fa-search mr-1" aria-hidden="true"></i>搜索
                    </button>
                </div>
            </div>
            <div class="overflow-x-auto rounded-lg border border-gray-200 shadow-sm" role="region"
                 aria-labelledby="lesson-list-heading">
                <h3 id="lesson-list-heading" class="sr-only">课程列表</h3>
                <table class="min-w-full bg-white">
                    <thead>
                    <tr class="bg-gradient-to-r from-blue-50 to-blue-100 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left" scope="col">课程ID</th>
                        <th class="py-3 px-6 text-left" scope="col">标题</th>
                        <th class="py-3 px-6 text-left" scope="col">描述</th>
                        <th class="py-3 px-6 text-left" scope="col">所属学期</th>
                        <th class="py-3 px-6 text-left" scope="col">所属教师</th>
                        <th class="py-3 px-6 text-center" scope="col">操作</th>
                        <th class="py-3 px-6 text-center" scope="col">详情</th>
                    </tr>
                    </thead>
                    <tbody id="lesson-list" class="text-gray-600 text-sm">
                    </tbody>
                </table>
                <div id="loading-lessons-message" class="text-center py-8 text-gray-500" style="display: none;"
                     aria-live="polite">
                    <div class="loader mb-3" role="status" aria-label="加载中"></div>
                    <p>正在加载课程数据...</p>
                </div>
                <div id="no-lessons-data-message" class="text-center py-8 text-gray-500" style="display: none;"
                     aria-live="polite">
                    <i class="fas fa-book-open text-4xl mb-2 text-gray-300" aria-hidden="true"></i>
                    <p>没有找到课程数据。</p>
                </div>
            </div>
        </section>

        <section id="student-management-section" class="card bg-white p-6 rounded-lg shadow-md mb-6"
                 style="display: none;">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-4 flex items-center">
                <i class="fas fa-user-graduate text-blue-500 mr-3" aria-hidden="true"></i>
                <span>学生管理</span>
            </h2>
            <div class="controls mb-6 flex flex-col sm:flex-row sm:items-end gap-4">
                <div class="flex flex-col flex-grow">
                    <label for="student-name-filter"
                           class="block text-gray-700 text-sm font-bold mb-1 flex items-center">
                        <i class="fas fa-filter text-blue-500 mr-2" aria-hidden="true"></i>
                        筛选姓名:
                    </label>
                    <input type="text" id="student-name-filter"
                           placeholder="输入学生姓名"
                           class="shadow appearance-none border rounded-lg py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                           aria-label="筛选学生姓名">
                </div>

                <div class="flex flex-col flex-grow">
                    <label for="student-number-filter"
                           class="block text-gray-700 text-sm font-bold mb-1 flex items-center">
                        <i class="fas fa-filter text-blue-500 mr-2" aria-hidden="true"></i>
                        筛选学号:
                    </label>
                    <input type="text" id="student-number-filter"
                           placeholder="输入学生学号"
                           class="shadow appearance-none border rounded-lg py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                           aria-label="筛选学生学号">
                </div>

                <div class="flex flex-col flex-grow">
                    <label for="student-class-filter"
                           class="block text-gray-700 text-sm font-bold mb-1 flex items-center">
                        <i class="fas fa-filter text-blue-500 mr-2" aria-hidden="true"></i>
                        筛选班级:
                    </label>
                    <input type="text" id="student-class-filter"
                           placeholder="输入学生班级"
                           class="shadow appearance-none border rounded-lg py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                           aria-label="筛选学生班级">
                </div>

                <div class="flex items-end flex-grow relative">
                    <i class="fas fa-search absolute left-3 bottom-2 text-gray-400" aria-hidden="true"></i>
                    <label for="student-search-input" class="sr-only">搜索学生</label>
                    <input type="text" id="student-search-input"
                           placeholder="搜索学生姓名、学号或班级..."
                           class="shadow appearance-none border rounded-lg flex-grow py-2 pl-10 pr-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                           aria-label="搜索学生姓名、学号或班级">
                    <button onclick="loadStudents()"
                            class="btn ml-2 bg-blue-500 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all flex items-center justify-center h-auto"
                            aria-label="搜索">
                        <i class="fas fa-search mr-1" aria-hidden="true"></i>搜索
                    </button>
                </div>
            </div>
            <div class="overflow-x-auto rounded-lg border border-gray-200 shadow-sm" role="region"
                 aria-labelledby="student-list-heading">
                <h3 id="student-list-heading" class="sr-only">学生列表</h3>
                <table class="min-w-full bg-white">
                    <thead>
                    <tr class="bg-gradient-to-r from-blue-50 to-blue-100 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left" scope="col">学生ID</th>
                        <th class="py-3 px-6 text-left" scope="col">学号</th>
                        <th class="py-3 px-6 text-left" scope="col">姓名</th>
                        <th class="py-3 px-6 text-left" scope="col">邮箱</th>
                        <th class="py-3 px-6 text-left" scope="col">学校</th>
                        <th class="py-3 px-6 text-left" scope="col">班级</th>
                        <th class="py-3 px-6 text-left" scope="col">已选课程</th>
                        <th class="py-3 px-6 text-left" scope="col">操作</th>
                    </tr>
                    </thead>
                    <tbody id="student-list" class="text-gray-600 text-sm">
                    </tbody>
                </table>
                <div id="loading-students-message" class="text-center py-8 text-gray-500" style="display: none;"
                     aria-live="polite">
                    <div class="loader mb-3" role="status" aria-label="加载中"></div>
                    <p>正在加载学生数据...</p>
                </div>
                <div id="no-students-data-message" class="text-center py-8 text-gray-500" style="display: none;"
                     aria-live="polite">
                    <i class="fas fa-user-slash text-4xl mb-2 text-gray-300" aria-hidden="true"></i>
                    <p>没有找到学生数据。</p>
                </div>
            </div>
        </section>

        <section id="question-management-section" class="card bg-white p-6 rounded-lg shadow-md mb-6"
                 style="display: none;">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-4 flex items-center">
                <i class="fas fa-question-circle text-blue-500 mr-3" aria-hidden="true"></i>
                <span>题目管理</span>
            </h2>
            <div class="controls mb-6 flex flex-col sm:flex-row sm:items-end gap-4">
                <div class="flex flex-col flex-grow">
                    <label for="question-type-filter"
                           class="block text-gray-700 text-sm font-bold mb-1 flex items-center">
                        <i class="fas fa-filter text-blue-500 mr-2" aria-hidden="true"></i>
                        筛选类型:
                    </label>
                    <select id="question-type-filter"
                            class="shadow appearance-none border rounded-lg py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                        <option value="all">所有类型</option>
                        <option value="single_choice">单选题</option>
                        <option value="multiple_choice">多选题</option>
                        <option value="fill_blank">填空题</option>
                        <option value="essay">问答题</option>
                    </select>
                </div>

                <div class="flex flex-col flex-grow">
                    <label for="question-difficulty-filter"
                           class="block text-gray-700 text-sm font-bold mb-1 flex items-center">
                        <i class="fas fa-filter text-blue-500 mr-2" aria-hidden="true"></i>
                        筛选难度:
                    </label>
                    <select id="question-difficulty-filter"
                            class="shadow appearance-none border rounded-lg py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                        <option value="all">所有难度</option>
                        <option value="easy">简单</option>
                        <option value="medium">中等</option>
                        <option value="hard">困难</option>
                    </select>
                </div>

                <div class="flex flex-col flex-grow">
                    <label for="lesson-id-filter" class="block text-gray-700 text-sm font-bold mb-1 flex items-center">
                        <i class="fas fa-filter text-blue-500 mr-2" aria-hidden="true"></i>
                        筛选课程ID:
                    </label>
                    <input type="number" id="lesson-id-filter"
                           placeholder="输入课程ID"
                           class="shadow appearance-none border rounded-lg py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                           aria-label="筛选课程ID">
                </div>

                <div class="flex items-end flex-grow relative">
                    <i class="fas fa-search absolute left-3 bottom-2 text-gray-400" aria-hidden="true"></i>
                    <label for="question-search-input" class="sr-only">搜索题目</label>
                    <input type="text" id="question-search-input"
                           placeholder="搜索题干内容..."
                           class="shadow appearance-none border rounded-lg flex-grow py-2 pl-10 pr-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                           aria-label="搜索题目内容">
                    <button onclick="loadQuestions()"
                            class="btn ml-2 bg-blue-500 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all flex items-center justify-center h-auto"
                            aria-label="搜索">
                        <i class="fas fa-search mr-1" aria-hidden="true"></i>搜索
                    </button>
                </div>
            </div>

            <div class="overflow-x-auto rounded-lg border border-gray-200 shadow-sm" role="region"
                 aria-labelledby="question-list-heading">
                <h3 id="question-list-heading" class="sr-only">题目列表</h3>
                <table class="min-w-full bg-white">
                    <thead>
                    <tr class="bg-gradient-to-r from-blue-50 to-blue-100 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left" scope="col">题目ID</th>
                        <th class="py-3 px-6 text-left" scope="col">课程ID</th>
                        <th class="py-3 px-6 text-left" scope="col">题干内容</th>
                        <th class="py-3 px-6 text-left" scope="col">类型</th>
                        <th class="py-3 px-6 text-left" scope="col">难度</th>
                        <th class="py-3 px-6 text-left" scope="col">分值</th>
                    </tr>
                    </thead>
                    <tbody id="question-list" class="text-gray-600 text-sm">
                    </tbody>
                </table>
                <div id="loading-questions-message" class="text-center py-8 text-gray-500" style="display: none;"
                     aria-live="polite">
                    <div class="loader mb-3" role="status" aria-label="加载中"></div>
                    <p>正在加载题目数据...</p>
                </div>
                <div id="no-questions-data-message" class="text-center py-8 text-gray-500" style="display: none;"
                     aria-live="polite">
                    <i class="fas fa-search text-4xl mb-2 text-gray-300" aria-hidden="true"></i>
                    <p>没有找到匹配的题目。</p>
                </div>
            </div>
        </section>

        <section id="semester-management-section" class="card bg-white p-6 rounded-lg shadow-md mb-6"
                 style="display: none;">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-4 flex items-center">
                <i class="fas fa-calendar-alt text-blue-500 mr-3" aria-hidden="true"></i>
                <span>学期管理</span>
            </h2>
            <div class="controls mb-6 flex items-end gap-4">
            </div>
            <div class="overflow-x-auto rounded-lg border border-gray-200 shadow-sm" role="region"
                 aria-labelledby="semester-list-heading">
                <h3 id="semester-list-heading" class="sr-only">学期列表</h3>
                <table class="min-w-full bg-white">
                    <thead>
                    <tr class="bg-gradient-to-r from-blue-50 to-blue-100 text-gray-600 uppercase text-sm leading-normal">
                        <th class="py-3 px-6 text-left" scope="col">学期ID</th>
                        <th class="py-3 px-6 text-left" scope="col">名称</th>
                        <th class="py-3 px-6 text-left" scope="col">开始日期</th>
                        <th class="py-3 px-6 text-left" scope="col">结束日期</th>
                        <th class="py-3 px-6 text-left" scope="col">创建时间</th>
                    </tr>
                    </thead>
                    <tbody id="semester-list" class="text-gray-600 text-sm">
                    </tbody>
                </table>
                <div id="loading-semesters-message" class="text-center py-8 text-gray-500" style="display: none;"
                     aria-live="polite">
                    <div class="loader mb-3" role="status" aria-label="加载中"></div>
                    <p>正在加载学期数据...</p>
                </div>
                <div id="no-semesters-data-message" class="text-center py-8 text-gray-500" style="display: none;"
                     aria-live="polite">
                    <i class="fas fa-calendar-times text-4xl mb-2 text-gray-300" aria-hidden="true"></i>
                    <p>没有找到学期数据。</p>
                </div>
            </div>
        </section>

        <section id="personal-info-section" class="card bg-white p-6 rounded-lg shadow-md mb-6" style="display: none;">
            <h2 id="personal-info-heading"
                class="text-2xl font-bold mb-6 text-gray-800 border-b pb-4 flex items-center">
                <i class="fas fa-user text-blue-500 mr-3" aria-hidden="true"></i>
                <span>个人信息</span>
            </h2>
            <div id="personal-info-content" class="text-gray-700">
                <div class="loader mb-3" role="status" aria-label="加载中"></div>
                <p class="text-center">正在加载个人信息...</p>
            </div>
        </section>
    </main>
</div>

<div id="select-class-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 animate__animated animate__fadeIn">
    <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md animate__animated animate__zoomIn">
        <h3 id="select-class-modal-title" class="text-xl font-bold mb-4 text-gray-800 border-b pb-3">为教师选班</h3>
        <div id="modal-class-list" class="mb-4 max-h-60 overflow-y-auto">
            <div class="loader mb-3" role="status" aria-label="加载中"></div>
            <p class="text-center text-gray-500">正在加载班级列表...</p>
        </div>
        <div class="flex justify-end gap-3">
            <button onclick="closeSelectClassModal()"
                    class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-300 transition-all">
                取消
            </button>
            <button id="select-class-modal-save-btn" onclick="saveTeacherClass()"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all">
                保存
            </button>
        </div>
    </div>
</div>

<div id="add-class-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 animate__animated animate__fadeIn">
    <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md animate__animated animate__zoomIn">
        <h3 class="text-xl font-bold mb-4 text-gray-800 border-b pb-3">添加新班级</h3>
        <div class="mb-4">
            <label for="new-class-name" class="block text-gray-700 text-sm font-bold mb-2">班级名称:</label>
            <input type="text" id="new-class-name"
                   class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                   placeholder="请输入班级名称" aria-label="班级名称">
        </div>
        <div class="flex justify-end gap-3">
            <button onclick="closeAddClassModal()"
                    class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-300 transition-all">
                取消
            </button>
            <button onclick="saveNewClass()"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all">
                保存
            </button>
        </div>
    </div>
</div>

<div id="add-lesson-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 animate__animated animate__fadeIn">
    <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md animate__animated animate__zoomIn">
        <h3 class="text-xl font-bold mb-4 text-gray-800 border-b pb-3">添加新课程</h3>
        <div class="mb-4">
            <label for="new-lesson-title" class="block text-gray-700 text-sm font-bold mb-2">课程标题:</label>
            <input type="text" id="new-lesson-title"
                   class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                   placeholder="请输入课程标题" aria-label="课程标题">
        </div>
        <div class="mb-4">
            <label for="new-lesson-description" class="block text-gray-700 text-sm font-bold mb-2">课程描述:</label>
            <textarea id="new-lesson-description"
                      class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all h-24 resize-none"
                      placeholder="请输入课程描述 (可选)" aria-label="课程描述"></textarea>
        </div>
        <div class="mb-4">
            <label for="new-lesson-semester" class="block text-gray-700 text-sm font-bold mb-2">所属学期:</label>
            <select id="new-lesson-semester"
                    class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                    aria-label="所选学期">
            </select>
        </div>
        <div class="mb-4">
            <label for="new-lesson-teacher" class="block text-gray-700 text-sm font-bold mb-2">指定教师:</label>
            <select id="new-lesson-teacher"
                    class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                    aria-label="指定教师">
            </select>
        </div>
        <div class="flex justify-end gap-3">
            <button onclick="closeAddLessonModal()"
                    class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-300 transition-all">
                取消
            </button>
            <button onclick="saveNewLesson()"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all">
                保存
            </button>
        </div>
    </div>
</div>

<div id="assign-teacher-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 animate__animated animate__fadeIn">
    <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md animate__animated animate__zoomIn">
        <h3 id="assign-teacher-modal-title" class="text-xl font-bold mb-4 text-gray-800 border-b pb-3">为课程指定教师</h3>
        <input type="hidden" id="assign-teacher-lesson-id">
        <div id="modal-teacher-list" class="mb-4 max-h-60 overflow-y-auto">
            <div class="loader mb-3" role="status" aria-label="加载中"></div>
            <p class="text-center text-gray-500">正在加载教师列表...</p>
        </div>
        <div class="flex justify-end gap-3">
            <button onclick="closeAssignTeacherModal()"
                    class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-300 transition-all">
                取消
            </button>
            <button id="assign-teacher-modal-save-btn" onclick="saveAssignedTeacher()"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all">
                保存
            </button>
        </div>
    </div>
</div>

<div id="enroll-courses-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50 animate__animated animate__fadeIn">
    <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md animate__animated animate__zoomIn">
        <h3 id="enroll-courses-modal-title" class="text-xl font-bold mb-4 text-gray-800 border-b pb-3">为学生选课</h3>
        <input type="hidden" id="enroll-courses-student-id">
        <div id="modal-lesson-list" class="mb-4 max-h-60 overflow-y-auto">
            <div class="loader mb-3" role="status" aria-label="加载中"></div>
            <p class="text-center text-gray-500">正在加载课程列表...</p>
        </div>
        <div class="flex justify-end gap-3">
            <button onclick="closeEnrollCoursesModal()"
                    class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-300 transition-all">
                取消
            </button>
            <button id="enroll-courses-modal-save-btn" onclick="saveStudentCourses()"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all">
                保存
            </button>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script>
    console.log("admin.html script loaded. Version: 2024-05-22-v4");

    let allClassesMap = new Map();
    let allTeachersMap = new Map();
    let allSemestersMap = new Map();
    let allLessonsMap = new Map();
    let currentTeacherIdForClass = null;
    let currentTeacherNameForClass = null;
    let currentLessonIdForTeacherAssignment = null;
    let currentStudentIdForLessonEnrollment = null;
    let allTeachersData = [];
    let allSemestersData = [];
    let allLessonsData = [];
    let allStudentsData = [];
    let expandedClassRows = new Set();
    let expandedLessonRows = new Set();

    function animateEntranceSequence() {
        document.getElementById('dashboard-section').classList.add('animate__animated', 'animate__fadeIn');
    }

    function logout() {
        showNotification("正在退出登录...", "info");

        $.post("/Anotherview/api/adminLogout", function () {
            showNotification("已成功退出登录", "success");
            setTimeout(() => {
                window.location.href = "/Anotherview/html/admin/admin-login.html";
            }, 1000);
        }).fail(() => {
            showNotification("退出失败，请重试", "error");
        });
    }

    function navigateTo(page) {
        $(".sidebar-button").removeClass("active").attr("aria-current", "false");

        $("#dashboard-section").hide();
        $("#class-management-section").hide();
        $("#teacher-management-section").hide();
        $("#course-management-section").hide();
        $("#student-management-section").hide();
        $("#question-management-section").hide();
        $("#semester-management-section").hide();
        $("#personal-info-section").hide();

        $('.sidebar-button').each(function () {
            if ($(this).attr('onclick').includes(`('${page}')`)) {
                $(this).addClass('active').attr("aria-current", "page");
            }
        });

        if (page === 'dashboard') {
            $("#dashboard-section").show();
        } else if (page === 'class-management') {
            $("#class-management-section").show();
            loadClasses();
        } else if (page === 'teacher-management') {
            $("#teacher-management-section").show();
            loadTeachers();
        } else if (page === 'course-management') {
            $("#course-management-section").show();
            loadLessons();
        } else if (page === 'student-management') {
            $("#student-management-section").show();
            $.when(loadLessons()).done(function() {
                loadStudents();
            }).fail(function() {
                showNotification("加载课程数据失败，无法显示学生选课信息。", "error");
                loadStudents();
            });
        } else if (page === 'question-management') {
            $("#question-management-section").show();
            loadQuestions();
        } else if (page === 'semester-management') {
            $("#semester-management-section").show();
            loadSemesters();
        } else if (page === 'profile') {
            $("#personal-info-section").show();
            loadPersonalInfo();
        }
    }

    function loadPersonalInfo() {
        const $personalInfoContent = $("#personal-info-content");
        $personalInfoContent.html(`
            <div class="loader mb-3" role="status" aria-label="加载中"></div>
            <p class="text-center">正在加载个人信息...</p>
        `);

        $.get("/Anotherview/api/adminInfo", {action: "getAdminInfo"}, function (response) {
            $personalInfoContent.empty();
            if (response.success && response.admin) {
                const admin = response.admin;
                $("#username").text(admin.name);
                $("#dashboard-admin-name").text(admin.name);
                $personalInfoContent.append(`
                    <div class="info-item"><i class="fas fa-id-card" aria-hidden="true"></i><strong>管理员ID:</strong> ${admin.id || 'N\A'}</div>
                    <div class="info-item"><i class="fas fa-user" aria-hidden="true"></i><strong>姓名:</strong> ${admin.name || 'N\A'}</div>
                    <div class="info-item"><i class="fas fa-envelope" aria-hidden="true"></i><strong>邮箱:</strong> ${admin.email || 'N\A'}</div>
                    <div class="info-item"><i class="fas fa-calendar-alt" aria-hidden="true"></i><strong>创建日期:</strong> ${admin.createdAt ? formatDisplayDateTime(admin.createdAt) : 'N\A'}</div>
                    <div class="info-item"><i class="fas fa-clock" aria-hidden="true"></i><strong>上次登录:</strong> ${admin.lastLogin ? formatDisplayDateTime(admin.lastLogin) : 'N\A'}</div>
                `);
            } else {
                $personalInfoContent.html(`
                    <i class="fas fa-exclamation-circle text-4xl mb-2 text-red-400" aria-hidden="true"></i>
                    <p class="text-center">无法获取个人信息。</p>
               `);
                showNotification("无法获取管理员信息，请重新登录", "error");
                setTimeout(() => {
                    window.location.href = "/Anotherview/html/admin/admin-login.html";
                }, 2000);
            }
        }).fail((xhr, status, error) => {
            console.error("加载个人信息失败:", error);
            $personalInfoContent.html(`
                <i class="fas fa-exclamation-circle text-4xl mb-2 text-red-400" aria-hidden="true"></i>
                <p class="text-center">加载个人信息失败。</p>
            `);
            showNotification('加载个人信息失败: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText) + "，请重新登录", "error");
            setTimeout(() => {
                window.location.href = "/Anotherview/html/admin/admin-login.html";
            }, 2000);
        });
    }

    function loadQuestions() {
        $("#loading-questions-message").show();
        $("#no-questions-data-message").hide();
        $("#question-list").empty();

        for (let i = 0; i < 5; i++) {
            $("#question-list").append(`
                <tr>
                    <td colspan="6" class="py-4">
                        <div class="shimmer w-full h-10 rounded-md"></div>
                    </td>
                </tr>
            `);
        }

        const typeFilter = $('#question-type-filter').val();
        const difficultyFilter = $('#question-difficulty-filter').val();
        const lessonIdFilter = $('#lesson-id-filter').val();
        const searchTerm = $("#question-search-input").val().trim();

        $.get("/Anotherview/api/adminInfo", {action: "getQuestions"}, function (response) {
            $("#question-list").empty();
            $("#loading-questions-message").hide();

            if (response.success && response.questions && response.questions.length > 0) {
                let filteredQuestions = response.questions.filter(question => {
                    const matchesType = typeFilter === 'all' || question.type === typeFilter;
                    const matchesDifficulty = difficultyFilter === 'all' || question.difficulty === difficultyFilter;
                    const matchesSearch = searchTerm === '' ||
                        question.content.includes(searchTerm);
                    const matchesLessonId = lessonIdFilter === '' || parseInt(lessonIdFilter) === question.lessonId;
                    return matchesType && matchesDifficulty && matchesSearch && matchesLessonId;
                });
                renderQuestions(filteredQuestions);
            } else {
                $("#no-questions-data-message").show();
            }
        }).fail((xhr, status, error) => {
            $("#question-list").empty();
            $("#loading-questions-message").hide();
            $("#no-questions-data-message").show().find('p').text('加载题目数据失败。');
            showNotification('加载题目数据失败: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText), "error");
            console.error("Error loading questions:", error, xhr.responseText);
        });
    }

    function renderQuestions(questions) {
        const $questionListTbody = $("#question-list");
        $questionListTbody.empty();

        if (!questions || questions.length === 0) {
            $("#no-questions-data-message").show();
            return;
        } else {
            $("#no-questions-data-message").hide();
        }

        questions.forEach((question, index) => {
            const typeDisplay = getQuestionTypeDisplay(question.type);
            const difficultyDisplay = getDifficultyDisplay(question.difficulty);
            const row = $(`
                <tr class="border-b border-gray-200 hover:bg-blue-50" data-index="${index}">
                    <td class="py-3 px-6 text-left font-semibold">${question.id || 'N\A'}</td>
                    <td class="py-3 px-6 text-left">${question.lessonId || 'N\A'}</td>
                    <td class="py-3 px-6 text-left max-w-xs overflow-hidden text-ellipsis whitespace-nowrap" title="${question.content}">${question.content || 'N\A'}</td>
                    <td class="py-3 px-6 text-left">
                        <span class="badge bg-blue-100 border border-blue-300 text-blue-800">${typeDisplay}</span>
                    </td>
                    <td class="py-3 px-6 text-left">
                        <span class="badge bg-gray-100 border border-gray-300 ${difficultyDisplay.class}">${difficultyDisplay.text}</span>
                    </td>
                    <td class="py-3 px-6 text-left">${question.score || 'N\A'}</td>
                </tr>
            `);
            $questionListTbody.append(row);
            setTimeout(() => row.addClass('fade-in'), index * 50);
        });
    }

    function loadClasses() {
        $("#loading-classes-message").show();
        $("#no-classes-data-message").hide();
        $("#class-list").empty();

        for (let i = 0; i < 5; i++) {
            $("#class-list").append(`
                <tr>
                    <td colspan="3" class="py-4">
                        <div class="shimmer w-full h-10 rounded-md"></div>
                    </td>
                </tr>
            `);
        }

        $.get("/Anotherview/api/adminInfo", {action: "getClasses"}, function (response) {
            $("#class-list").empty();
            $("#loading-classes-message").hide();
            if (response.success && response.classes && response.classes.length > 0) {
                renderClasses(response.classes);
            } else {
                $("#no-classes-data-message").show();
            }
        }).fail((xhr, status, error) => {
            $("#class-list").empty();
            $("#loading-classes-message").hide();
            $("#no-classes-data-message").show().find('p').text('加载班级数据失败。');
            showNotification('加载班级数据失败: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText), "error");
            console.error("Error loading classes:", error, xhr.responseText);
        });
    }

    function renderClasses(classes) {
        const $classListTbody = $("#class-list");
        $classListTbody.empty();

        if (!classes || classes.length === 0) {
            $("#no-classes-data-message").show();
            return;
        } else {
            $("#no-classes-data-message").hide();
        }

        classes.forEach((cls, index) => {
            const row = $(`
                <tr class="border-b border-gray-200 hover:bg-blue-50 cursor-pointer" data-class-id="${cls.id}" data-index="${index}" onclick="toggleClassDetails(${cls.id}, this, 'class')">
                    <td class="py-3 px-6 text-left font-semibold">${cls.id || 'N\A'}</td>
                    <td class="py-3 px-6 text-left">${cls.name || 'N\A'}</td>
                    <td class="py-3 px-6 text-center">
                        <i class="fas fa-chevron-down text-blue-500 transition-transform duration-300 ${expandedClassRows.has(cls.id) ? 'rotate-180' : ''}"></i>
                    </td>
                </tr>
                <tr id="class-details-${cls.id}" class="${expandedClassRows.has(cls.id) ? '' : 'hidden'}">
                    <td colspan="3" class="p-4 bg-blue-50">
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="w-full md:w-1/2">
                                <h4 class="text-lg font-bold mb-2 text-gray-800 flex items-center">
                                    <i class="fas fa-user-graduate mr-2 text-blue-600"></i>班级学生
                                </h4>
                                <div id="class-${cls.id}-students-list" class="bg-white p-3 rounded-md shadow-sm max-h-40 overflow-y-auto">
                                    <div class="loader mb-3" role="status" aria-label="加载中"></div>
                                    <p class="text-center text-gray-500">正在加载学生数据...</p>
                                </div>
                            </div>
                            <div class="w-full md:w-1/2">
                                <h4 class="text-lg font-bold mb-2 text-gray-800 flex items-center">
                                    <i class="fas fa-chalkboard-teacher mr-2 text-blue-600"></i>班级教师
                                </h4>
                                <div id="class-${cls.id}-teachers-list" class="bg-white p-3 rounded-md shadow-sm max-h-40 overflow-y-auto">
                                    <div class="loader mb-3" role="status" aria-label="加载中"></div>
                                    <p class="text-center text-gray-500">正在加载教师数据...</p>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            `);
            $classListTbody.append(row);
            setTimeout(() => row.addClass('fade-in'), index * 50);

            if (expandedClassRows.has(cls.id)) {
                loadStudentsForClass(cls.id);
                loadTeachersForClass(cls.id);
            }
        });
    }

    function loadAllClasses() {
        return $.get("/Anotherview/api/adminInfo", {action: "getClasses"}, function (response) {
            if (response.success && response.classes) {
                allClassesMap.clear();
                response.classes.forEach(cls => {
                    allClassesMap.set(cls.id, cls.name);
                });
            } else {
                console.error("Failed to load all classes:", response.message);
            }
        }).fail((xhr) => {
            console.error("Error loading all classes:", xhr.responseText);
        });
    }

    function loadTeachers() {
        $("#loading-teachers-message").show();
        $("#no-teachers-data-message").hide();
        $("#teacher-list").empty();

        for (let i = 0; i < 5; i++) {
            $("#teacher-list").append(`
                <tr>
                    <td colspan="5" class="py-4">
                        <div class="shimmer w-full h-10 rounded-md"></div>
                    </td>
                </tr>
            `);
        }

        $.get("/Anotherview/api/adminInfo", {action: "getTeachers"}, function (response) {
            $("#teacher-list").empty();
            $("#loading-teachers-message").hide();

            if (response.success && response.teachers && response.teachers.length > 0) {
                allTeachersData = response.teachers;
                renderTeachers(allTeachersData);
            } else {
                $("#no-teachers-data-message").show();
            }
        }).fail((xhr, status, error) => {
            $("#teacher-list").empty();
            $("#loading-teachers-message").hide();
            $("#no-teachers-data-message").show().find('p').text('加载教师数据失败。');
            showNotification('加载教师数据失败: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText), "error");
            console.error("Error loading teachers:", error, xhr.responseText);
        });
    }

    function renderTeachers(teachers) {
        const $teacherListTbody = $("#teacher-list");
        $teacherListTbody.empty();
        allTeachersMap.clear();

        if (!teachers || teachers.length === 0) {
            $("#no-teachers-data-message").show();
            return;
        } else {
            $("#no-teachers-data-message").hide();
        }

        const nameFilter = $('#teacher-name-filter').val().toLowerCase();
        const emailFilter = $('#teacher-email-filter').val().toLowerCase();
        const searchTerm = $("#teacher-search-input").val().toLowerCase().trim();

        let filteredTeachers = teachers.filter(teacher => {
            const matchesName = nameFilter === '' || (teacher.name && teacher.name.toLowerCase().includes(nameFilter));
            const matchesEmail = emailFilter === '' || (teacher.email && teacher.email.toLowerCase().includes(emailFilter));
            const matchesSearch = searchTerm === '' ||
                (teacher.name && teacher.name.toLowerCase().includes(searchTerm)) ||
                (teacher.email && teacher.email.toLowerCase().includes(searchTerm));
            return matchesName && matchesEmail && matchesSearch;
        });


        filteredTeachers.forEach((teacher, index) => {
            allTeachersMap.set(teacher.id, teacher.name);
            $.get("/Anotherview/api/adminInfo", {action: "getTeacherClasses", teacherId: teacher.id}, function (classResponse) {
                let associatedClassName = "未分配";
                let associatedClassId = -1;
                if (classResponse.success && classResponse.associatedClassIds && classResponse.associatedClassIds.length > 0) {
                    associatedClassId = classResponse.associatedClassIds[0];
                    associatedClassName = allClassesMap.get(associatedClassId) || `ID: ${associatedClassId}`;
                }

                const row = $(`
                    <tr class="border-b border-gray-200 hover:bg-blue-50" data-teacher-id="${teacher.id}">
                        <td class="py-3 px-6 text-left font-semibold">${teacher.id || 'N\A'}</td>
                        <td class="py-3 px-6 text-left">${teacher.name || 'N\A'}</td>
                        <td class="py-3 px-6 text-left">${teacher.email || 'N\A'}</td>
                        <td class="py-3 px-6 text-left" id="teacher-${teacher.id}-class-name">${associatedClassName}</td>
                        <td class="py-3 px-6 text-left">
                            <button onclick="openSelectClassModal(${teacher.id}, '${teacher.name}', ${associatedClassId})"
                                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-3 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all">
                                <i class="fas fa-edit mr-1"></i>管理班级
                            </button>
                        </td>
                    </tr>
                `);
                $teacherListTbody.append(row);
                setTimeout(() => row.addClass('fade-in'), index * 50);
            }).fail((xhr) => {
                const row = $(`
                    <tr class="border-b border-gray-200 hover:bg-blue-50" data-teacher-id="${teacher.id}">
                        <td class="py-3 px-6 text-left font-semibold">${teacher.id || 'N\A'}</td>
                        <td class="py-3 px-6 text-left">${teacher.name || 'N\A'}</td>
                        <td class="py-3 px-6 text-left">${teacher.email || 'N\A'}</td>
                        <td class="py-3 px-6 text-left" id="teacher-${teacher.id}-class-name">加载失败</td>
                        <td class="py-3 px-6 text-left">
                            <button onclick="openSelectClassModal(${teacher.id}, '${teacher.name}', -1)"
                                    class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-3 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all">
                                <i class="fas fa-edit mr-1"></i>管理班级
                            </button>
                        </td>
                    </tr>
                `);
                $teacherListTbody.append(row);
                setTimeout(() => row.addClass('fade-in'), index * 50);
                console.error(`Error loading classes for teacher ${teacher.id}:`, xhr.responseText);
            });
        });
    }

    function loadAllTeachers() {
        return $.get("/Anotherview/api/adminInfo", {action: "getTeachers"}, function (response) {
            if (response.success && response.teachers) {
                allTeachersData = response.teachers;
                allTeachersMap.clear();
                response.teachers.forEach(teacher => {
                    allTeachersMap.set(teacher.id, teacher.name);
                });
            } else {
                console.error("Failed to load all teachers:", response.message);
            }
        }).fail((xhr) => {
            console.error("Error loading all teachers:", xhr.responseText);
        });
    }

    function loadSemesters() {
        $("#loading-semesters-message").show();
        $("#no-semesters-data-message").hide();
        $("#semester-list").empty();

        for (let i = 0; i < 5; i++) {
            $("#semester-list").append(`
                <tr>
                    <td colspan="5" class="py-4">
                        <div class="shimmer w-full h-10 rounded-md"></div>
                    </td>
                </tr>
            `);
        }

        return $.get("/Anotherview/api/adminInfo", {action: "getSemesters"}, function (response) {
            $("#semester-list").empty();
            $("#loading-semesters-message").hide();

            if (response.success && response.semesters && response.semesters.length > 0) {
                allSemestersData = response.semesters;
                renderSemesters(allSemestersData);
            } else {
                $("#no-semesters-data-message").show();
            }
        }).fail((xhr, status, error) => {
            $("#semester-list").empty();
            $("#loading-semesters-message").hide();
            $("#no-semesters-data-message").show().find('p').text('加载学期数据失败。');
            showNotification('加载学期数据失败: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText), "error");
            console.error("Error loading semesters:", error, xhr.responseText);
        });
    }

    function renderSemesters(semesters) {
        const $semesterListTbody = $("#semester-list");
        $semesterListTbody.empty();
        allSemestersMap.clear();

        if (!semesters || semesters.length === 0) {
            $("#no-semesters-data-message").show();
            return;
        } else {
            $("#no-semesters-data-message").hide();
        }

        semesters.forEach((semester, index) => {
            allSemestersMap.set(semester.id, semester.name);
            const row = $(`
                <tr class="border-b border-gray-200 hover:bg-blue-50" data-semester-id="${semester.id}">
                    <td class="py-3 px-6 text-left font-semibold">${semester.id || 'N\A'}</td>
                    <td class="py-3 px-6 text-left">${semester.name || 'N\A'}</td>
                    <td class="py-3 px-6 text-left">${semester.startDate || 'N\A'}</td>
                    <td class="py-3 px-6 text-left">${semester.endDate || 'N\A'}</td>
                    <td class="py-3 px-6 text-left">${semester.createdAt ? formatDisplayDateTime(semester.createdAt) : 'N\A'}</td>
                </tr>
            `);
            $semesterListTbody.append(row);
            setTimeout(() => row.addClass('fade-in'), index * 50);
        });
    }

    function loadLessons() {
        $("#loading-lessons-message").show();
        $("#no-lessons-data-message").hide();
        $("#lesson-list").empty();

        for (let i = 0; i < 5; i++) {
            $("#lesson-list").append(`
                <tr>
                    <td colspan="7" class="py-4">
                        <div class="shimmer w-full h-10 rounded-md"></div>
                    </td>
                </tr>
            `);
        }

        return $.get("/Anotherview/api/adminInfo", {action: "getLessons"}, function (response) {
            $("#lesson-list").empty();
            $("#loading-lessons-message").hide();
            if (response.success && response.lessons && response.lessons.length > 0) {
                allLessonsData = response.lessons;
                allLessonsMap.clear();
                response.lessons.forEach(lesson => {
                    allLessonsMap.set(lesson.id, lesson.title);
                });
                renderLessons(allLessonsData);
            } else {
                $("#no-lessons-data-message").show();
            }
        }).fail((xhr, status, error) => {
            $("#lesson-list").empty();
            $("#loading-lessons-message").hide();
            $("#no-lessons-data-message").show().find('p').text('加载课程数据失败。');
            showNotification('加载课程数据失败: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText), "error");
            console.error("Error loading lessons:", error, xhr.responseText);
        });
    }

    function renderLessons(lessons) {
        const $lessonListTbody = $("#lesson-list");
        $lessonListTbody.empty();

        if (!lessons || lessons.length === 0) {
            $("#no-lessons-data-message").show();
            return;
        } else {
            $("#no-lessons-data-message").hide();
        }

        const titleFilter = $('#lesson-title-filter').val().toLowerCase();
        const teacherFilter = $('#lesson-teacher-filter').val().toLowerCase();
        const semesterFilter = $('#lesson-semester-filter').val().toLowerCase();
        const searchTerm = $("#lesson-search-input").val().toLowerCase().trim();

        let filteredLessons = lessons.filter(lesson => {
            const matchesTitle = titleFilter === '' || (lesson.title && lesson.title.toLowerCase().includes(titleFilter));
            const teacherName = allTeachersMap.get(lesson.teacherId) || '';
            const matchesTeacher = teacherFilter === '' || teacherName.toLowerCase().includes(teacherFilter);
            const semesterName = allSemestersMap.get(lesson.semesterId) || '';
            const matchesSemester = semesterFilter === '' || semesterName.toLowerCase().includes(semesterFilter);
            const matchesSearch = searchTerm === '' ||
                (lesson.title && lesson.title.toLowerCase().includes(searchTerm)) ||
                (lesson.description && lesson.description.toLowerCase().includes(searchTerm)) ||
                teacherName.toLowerCase().includes(searchTerm) ||
                semesterName.toLowerCase().includes(searchTerm);
            return matchesTitle && matchesTeacher && matchesSemester && matchesSearch;
        });

        filteredLessons.forEach((lesson, index) => {
            const teacherName = allTeachersMap.get(lesson.teacherId) || '未指定教师';
            const semesterName = allSemestersMap.get(lesson.semesterId) || '未知学期';
            const row = $(`
                <tr class="border-b border-gray-200 hover:bg-blue-50 cursor-pointer" data-lesson-id="${lesson.id}" data-index="${index}" onclick="toggleClassDetails(${lesson.id}, this, 'lesson')">
                    <td class="py-3 px-6 text-left font-semibold">${lesson.id || 'N\A'}</td>
                    <td class="py-3 px-6 text-left max-w-xs overflow-hidden text-ellipsis whitespace-nowrap" title="${lesson.title}">${lesson.title || 'N\A'}</td>
                    <td class="py-3 px-6 text-left max-w-xs overflow-hidden text-ellipsis whitespace-nowrap" title="${lesson.description}">${lesson.description || '无'}</td>
                    <td class="py-3 px-6 text-left">${semesterName}</td>
                    <td class="py-3 px-6 text-left" id="lesson-${lesson.id}-teacher-name">${teacherName}</td>
                    <td class="py-3 px-6 text-center flex items-center justify-center">
                        <button onclick="event.stopPropagation(); openAssignTeacherModal(${lesson.id}, '${lesson.title}', ${lesson.teacherId})"
                                class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-purple-300 transition-all">
                            <i class="fas fa-user-plus mr-1"></i>指定教师
                        </button>
                    </td>
                    <td class="py-3 px-6 text-center">
                        <i class="fas fa-chevron-down text-blue-500 transition-transform duration-300 ${expandedLessonRows.has(lesson.id) ? 'rotate-180' : ''}"></i>
                    </td>
                </tr>
                <tr id="lesson-details-${lesson.id}" class="${expandedLessonRows.has(lesson.id) ? '' : 'hidden'}">
                    <td colspan="7" class="p-4 bg-blue-50">
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="w-full md:w-1/2">
                                <h4 class="text-lg font-bold mb-2 text-gray-800 flex items-center">
                                    <i class="fas fa-user-graduate mr-2 text-blue-600"></i>课程学生
                                </h4>
                                <div id="lesson-${lesson.id}-students-list" class="bg-white p-3 rounded-md shadow-sm max-h-40 overflow-y-auto">
                                    <div class="loader mb-3" role="status" aria-label="加载中"></div>
                                    <p class="text-center text-gray-500">正在加载学生数据...</p>
                                </div>
                            </div>
                            <div class="w-full md:w-1/2">
                                <h4 class="text-lg font-bold mb-2 text-gray-800 flex items-center">
                                    <i class="fas fa-chalkboard-teacher mr-2 text-blue-600"></i>课程教师
                                </h4>
                                <div id="lesson-${lesson.id}-teachers-list" class="bg-white p-3 rounded-md shadow-sm max-h-40 overflow-y-auto">
                                    <div class="loader mb-3" role="status" aria-label="加载中"></div>
                                    <p class="text-center text-gray-500">正在加载教师数据...</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col gap-2 text-gray-700 mt-4">
                            <p><strong>描述:</strong> <span id="lesson-${lesson.id}-description">${lesson.description || '无'}</span></p>
                            <p><strong>创建时间:</strong> <span id="lesson-${lesson.id}-createdAt">${lesson.createdAt ? formatDisplayDateTime(lesson.createdAt) : 'N\A'}</span></p>
                        </div>
                    </td>
                </tr>
            `);
            $lessonListTbody.append(row);
            setTimeout(() => row.addClass('fade-in'), index * 50);

            if (expandedLessonRows.has(lesson.id)) {
                loadLessonDetails(lesson.id);
            }
        });
    }

    function populateSemesterAndTeacherDropdowns() {
        const $newLessonSemester = $("#new-lesson-semester");
        const $newLessonTeacher = $("#new-lesson-teacher");
        $newLessonSemester.empty();
        $newLessonTeacher.empty();

        if (allSemestersData && allSemestersData.length > 0) {
            $newLessonSemester.append(`<option value="">请选择学期</option>`);
            allSemestersData.forEach(semester => {
                $newLessonSemester.append(`<option value="${semester.id}">${semester.name}</option>`);
            });
        } else {
            $newLessonSemester.append(`<option value="">暂无学期</option>`);
        }

        if (allTeachersData && allTeachersData.length > 0) {
            $newLessonTeacher.append(`<option value="">请选择教师</option>`);
            allTeachersData.forEach(teacher => {
                $newLessonTeacher.append(`<option value="${teacher.id}">${teacher.name}</option>`);
            });
        } else {
            $newLessonTeacher.append(`<option value="">暂无教师</option>`);
        }
    }

    function openAddClassModal() {
        $("#new-class-name").val('');
        $("#add-class-modal").removeClass("hidden").addClass("flex");
    }

    function closeAddClassModal() {
        $("#add-class-modal").removeClass("flex").addClass("hidden");
    }

    function saveNewClass() {
        const className = $("#new-class-name").val().trim();
        if (!className) {
            showNotification("班级名称不能为空。", "warning");
            return;
        }

        showNotification("正在添加班级...", "info");
        $("#add-class-modal button.bg-blue-500").prop('disabled', true);

        $.post("/Anotherview/api/adminInfo", {action: "addClass", className: className}, function (response) {
            if (response.success) {
                showNotification(response.message, "success");
                closeAddClassModal();
                loadClasses();
                loadAllClasses();
            } else {
                showNotification(response.message, "error");
            }
            $("#add-class-modal button.bg-blue-500").prop('disabled', false);
        }).fail((xhr) => {
            showNotification('添加班级失败: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText), "error");
            $("#add-class-modal button.bg-blue-500").prop('disabled', false);
        });
    }

    function openAddLessonModal() {
        $("#new-lesson-title").val('');
        $("#new-lesson-description").val('');
        populateSemesterAndTeacherDropdowns();
        $("#add-lesson-modal").removeClass("hidden").addClass("flex");
    }

    function closeAddLessonModal() {
        $("#add-lesson-modal").removeClass("flex").addClass("hidden");
    }

    function saveNewLesson() {
        const title = $("#new-lesson-title").val().trim();
        const description = $("#new-lesson-description").val().trim();
        const semesterId = $("#new-lesson-semester").val();
        const teacherId = $("#new-lesson-teacher").val();

        if (!title) {
            showNotification("课程标题不能为空！", "warning");
            return;
        }
        if (!semesterId) {
            showNotification("请选择所属学期！", "warning");
            return;
        }
        if (!teacherId) {
            showNotification("请选择指定教师！", "warning");
            return;
        }

        showNotification("正在添加课程...", "info");
        $("#add-lesson-modal button.bg-blue-500").prop('disabled', true);

        $.post("/Anotherview/api/adminInfo", {
            action: "addLesson",
            title: title,
            description: description,
            semesterId: semesterId,
            teacherId: teacherId
        }, function (response) {
            if (response.success) {
                showNotification(response.message, "success");
                closeAddLessonModal();
                loadLessons();
            } else {
                showNotification(response.message, "error");
            }
            $("#add-lesson-modal button.bg-blue-500").prop('disabled', false);
        }).fail((xhr) => {
            showNotification('添加课程失败: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText), "error");
            $("#add-lesson-modal button.bg-blue-500").prop('disabled', false);
        });
    }

    function openAssignTeacherModal(lessonId, lessonTitle, currentTeacherId) {
        currentLessonIdForTeacherAssignment = lessonId;
        $("#assign-teacher-modal-title").text(`为课程 "${lessonTitle}" 指定教师`);
        $("#assign-teacher-lesson-id").val(lessonId);
        const $teacherList = $("#modal-teacher-list");
        $teacherList.empty();

        if (allTeachersData.length === 0) {
            $teacherList.html('<p class="text-gray-600 text-center">没有可用教师。</p>');
            $("#assign-teacher-modal-save-btn").prop('disabled', true);
        } else {
            $teacherList.append('<label class="inline-flex items-center mt-3 p-2 rounded-md hover:bg-blue-50 cursor-pointer transition-all w-full"><input type="radio" class="form-radio h-5 w-5 text-blue-600" name="selectedTeacher" value="" disabled selected><span class="ml-2 text-gray-700">请选择教师</span></label>');

            allTeachersData.forEach(teacher => {
                const isChecked = teacher.id === currentTeacherId ? 'checked' : '';
                $teacherList.append(`
                    <label class="inline-flex items-center mt-3 p-2 rounded-md hover:bg-blue-50 cursor-pointer transition-all w-full">
                        <input type="radio" class="form-radio h-5 w-5 text-blue-600" name="selectedTeacher" value="${teacher.id}" ${isChecked}>
                        <span class="ml-2 text-gray-700">${teacher.name}</span>
                    </label>
                `);
            });
            if ($teacherList.find('input[type="radio"]').length <= 1) {
                $("#assign-teacher-modal-save-btn").prop('disabled', true);
            } else {
                $("#assign-teacher-modal-save-btn").prop('disabled', false);
            }
        }

        $("#assign-teacher-modal").removeClass("hidden").addClass("flex");
    }

    function closeAssignTeacherModal() {
        $("#assign-teacher-modal").removeClass("flex").addClass("hidden");
        currentLessonIdForTeacherAssignment = null;
    }

    function saveAssignedTeacher() {
        const lessonId = $("#assign-teacher-lesson-id").val();
        const selectedTeacherId = $('input[name="selectedTeacher"]:checked').val();

        if (!selectedTeacherId) {
            showNotification("请选择一个教师！", "warning");
            return;
        }

        showNotification("正在指定教师...", "info");
        $("#assign-teacher-modal-save-btn").prop('disabled', true);

        $.post("/Anotherview/api/adminInfo", {
            action: "assignTeacherToLesson",
            lessonId: lessonId,
            teacherId: selectedTeacherId
        }, function (response) {
            if (response.success) {
                showNotification("教师指定成功！", "success");
                closeAssignTeacherModal();
                loadLessons();
            } else {
                showNotification("教师指定失败: " + response.message, "error");
            }
            $("#assign-teacher-modal-save-btn").prop('disabled', false);
        }).fail((xhr) => {
            showNotification('教师指定失败: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText), "error");
            $("#assign-teacher-modal-save-btn").prop('disabled', false);
        });
    }

    function toggleClassDetails(id, clickedElement, type) {
        let $detailsRow;
        let $icon;
        let expandedSet;

        if (type === 'class') {
            $detailsRow = $(`#class-details-${id}`);
            $icon = $(clickedElement).find('.fa-chevron-down');
            expandedSet = expandedClassRows;
        } else if (type === 'lesson') {
            $detailsRow = $(`#lesson-details-${id}`);
            $icon = $(clickedElement).find('.fa-chevron-down');
            expandedSet = expandedLessonRows;
        } else {
            return;
        }

        if (expandedSet.has(id)) {
            $detailsRow.addClass('hidden');
            $icon.removeClass('rotate-180');
            expandedSet.delete(id);
        } else {
            $detailsRow.removeClass('hidden');
            $icon.addClass('rotate-180');
            expandedSet.add(id);
            if (type === 'class') {
                loadStudentsForClass(id);
                loadTeachersForClass(id);
            } else if (type === 'lesson') {
                loadLessonDetails(id);
            }
        }
    }

    function loadStudentsForClass(classId) {
        const $studentListDiv = $(`#class-${classId}-students-list`);
        $studentListDiv.html(`
            <div class="loader mb-3" role="status" aria-label="加载中"></div>
            <p class="text-center text-gray-500">正在加载学生数据...</p>
        `);

        $.get("/Anotherview/api/adminInfo", {action: "getStudentsByClassId", classId: classId}, function (response) {
            if (response.success && response.students && response.students.length > 0) {
                renderStudentsList($studentListDiv, response.students);
            } else {
                $studentListDiv.html('<p class="text-center text-gray-500"><i class="fas fa-user-slash mr-1"></i>该班级没有学生。</p>');
            }
        }).fail((xhr) => {
            $studentListDiv.html('<p class="text-center text-red-500"><i class="fas fa-exclamation-circle mr-1"></i>加载学生失败。</p>');
            console.error("加载班级学生失败:", xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText);
        });
    }

    function loadStudentsForLesson(lessonId) {
        const $studentListDiv = $(`#lesson-${lessonId}-students-list`);
        $studentListDiv.html(`
            <div class="loader mb-3" role="status" aria-label="加载中"></div>
            <p class="text-center text-gray-500">正在加载学生数据...</p>
        `);

        $.get("/Anotherview/api/adminInfo", {action: "getStudentsByLessonId", lessonId: lessonId}, function (response) {
            console.log(`Students for lesson ${lessonId}:`, response);
            if (response.success && response.students && response.students.length > 0) {
                renderStudentsList($studentListDiv, response.students);
            } else {
                $studentListDiv.html('<p class="text-center text-gray-500"><i class="fas fa-user-slash mr-1"></i>该课程没有学生。</p>');
            }
        }).fail((xhr) => {
            $studentListDiv.html('<p class="text-center text-red-500"><i class="fas fa-exclamation-circle mr-1"></i>加载学生失败。</p>');
            console.error("加载课程学生失败:", xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText);
        });
    }

    function renderStudentsList($targetDiv, students) {
        $targetDiv.empty();
        if (students.length === 0) {
            $targetDiv.html('<p class="text-center text-gray-500"><i class="fas fa-user-slash mr-1"></i>没有学生。</p>');
            return;
        }
        students.forEach(student => {
            $targetDiv.append(`
                <div class="flex items-center text-gray-700 py-1 border-b border-gray-100 last:border-b-0">
                    <i class="fas fa-user mr-2 text-blue-400"></i>
                    <span>姓名: ${student.name || 'N/A'}, 学号: ${student.studentNumber || 'N/A'}</span>
                </div>
            `);
        });
    }

    function loadTeachersForClass(classId) {
        const $teacherListDiv = $(`#class-${classId}-teachers-list`);
        $teacherListDiv.html(`
            <div class="loader mb-3" role="status" aria-label="加载中"></div>
            <p class="text-center text-gray-500">正在加载教师数据...</p>
        `);

        $.get("/Anotherview/api/adminInfo", {action: "getTeachersByClassId", classId: classId}, function (response) {
            if (response.success && response.teachers && response.teachers.length > 0) {
                renderTeachersList($teacherListDiv, response.teachers);
            } else {
                $teacherListDiv.html('<p class="text-center text-gray-500"><i class="fas fa-chalkboard-teacher mr-1"></i>该班级没有教师。</p>');
            }
        }).fail((xhr) => {
            $teacherListDiv.html('<p class="text-center text-red-500"><i class="fas fa-exclamation-circle mr-1"></i>加载教师失败。</p>');
            console.error("加载班级教师失败:", xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText);
        });
    }

    function loadTeachersForLesson(lessonId) {
        const $teacherListDiv = $(`#lesson-${lessonId}-teachers-list`);
        $teacherListDiv.html(`
            <div class="loader mb-3" role="status" aria-label="加载中"></div>
            <p class="text-center text-gray-500">正在加载教师数据...</p>
        `);

        $.get("/Anotherview/api/adminInfo", {action: "getTeachersByLessonId", lessonId: lessonId}, function (response) {
            console.log(`Teachers for lesson ${lessonId}:`, response);
            if (response.success && response.teachers && response.teachers.length > 0) {
                renderTeachersList($teacherListDiv, response.teachers);
            } else {
                $teacherListDiv.html('<p class="text-center text-gray-500"><i class="fas fa-chalkboard-teacher mr-1"></i>该课程没有教师。</p>');
            }
        }).fail((xhr) => {
            $teacherListDiv.html('<p class="text-center text-red-500"><i class="fas fa-exclamation-circle mr-1"></i>加载教师失败。</p>');
            console.error("加载课程教师失败:", xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText);
        });
    }

    function renderTeachersList($targetDiv, teachers) {
        $targetDiv.empty();
        if (teachers.length === 0) {
            $targetDiv.html('<p class="text-center text-gray-500"><i class="fas fa-chalkboard-teacher mr-1"></i>没有教师。</p>');
            return;
        }
        teachers.forEach(teacher => {
            $targetDiv.append(`
                <div class="flex items-center text-gray-700 py-1 border-b border-gray-100 last:border-b-0">
                    <i class="fas fa-user-tie mr-2 text-blue-400"></i>
                    <span>姓名: ${teacher.name || 'N/A'}, 邮箱: ${teacher.email || 'N/A'}</span>
                </div>
            `);
        });
    }

    function loadLessonDetails(lessonId) {
        loadStudentsForLesson(lessonId);
        loadTeachersForLesson(lessonId);
    }

    function openSelectClassModal(teacherId, teacherName, currentClassId) {
        currentTeacherIdForClass = teacherId;
        currentTeacherNameForClass = teacherName;
        $("#select-class-modal-title").text(`为 ${teacherName} 选班`);
        const $classList = $("#modal-class-list");
        $classList.empty();

        if (allClassesMap.size === 0) {
            $classList.html('<p class="text-gray-600 text-center">没有可用的班级。</p>');
            $("#select-class-modal-save-btn").prop('disabled', true);
        } else {
            $classList.append('<label class="inline-flex items-center mt-3 p-2 rounded-md hover:bg-blue-50 cursor-pointer transition-all w-full"><input type="radio" class="form-radio h-5 w-5 text-blue-600" name="selectedClass" value="" disabled selected><span class="ml-2 text-gray-700">请选择班级</span></label>');

            allClassesMap.forEach((className, classId) => {
                const isChecked = classId === currentClassId ? 'checked' : '';
                $classList.append(`
                    <label class="inline-flex items-center mt-3 p-2 rounded-md hover:bg-blue-50 cursor-pointer transition-all w-full">
                        <input type="radio" class="form-radio h-5 w-5 text-blue-600" name="selectedClass" value="${classId}" ${isChecked}>
                        <span class="ml-2 text-gray-700">${className}</span>
                    </label>
                `);
            });
            $("#select-class-modal-save-btn").prop('disabled', false);
        }

        $("#select-class-modal").removeClass("hidden").addClass("flex");
    }

    function saveTeacherClass() {
        const selectedClassId = $('input[name="selectedClass"]:checked').val();
        if (!selectedClassId) {
            showNotification("请选择一个班级！", "warning");
            return;
        }

        showNotification("正在保存班级关联...", "info");
        $("#select-class-modal-save-btn").prop('disabled', true);

        $.post("/Anotherview/api/adminInfo", {
            action: "updateTeacherClasses",
            teacherId: currentTeacherIdForClass,
            classIds: selectedClassId
        }, function (response) {
            if (response.success) {
                showNotification("班级关联更新成功！", "success");
                closeSelectClassModal();
                loadTeachers();
            } else {
                showNotification("班级关联更新失败: " + response.message, "error");
            }
            $("#select-class-modal-save-btn").prop('disabled', false);
        }).fail((xhr) => {
            showNotification('班级关联更新失败: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText), "error");
            $("#select-class-modal-save-btn").prop('disabled', false);
        });
    }

    function closeSelectClassModal() {
        $("#select-class-modal").addClass("hidden").removeClass("flex");
        currentTeacherIdForClass = null;
        currentTeacherNameForClass = null;
    }

    function showNotification(message, type = 'info') {
        const existingNotification = document.getElementById('custom-notification');
        if (existingNotification) {
            existingNotification.remove();
        }

        let icon, bgColor, textColor;
        switch (type) {
            case 'success':
                icon = 'fas fa-check-circle';
                bgColor = 'bg-green-500';
                textColor = 'text-white';
                break;
            case 'error':
                icon = 'fas fa-exclamation-circle';
                bgColor = 'bg-red-500';
                textColor = 'text-white';
                break;
            case 'warning':
                icon = 'fas fa-exclamation-triangle';
                bgColor = 'bg-yellow-500';
                textColor = 'text-white';
                break;
            default:
                icon = 'fas fa-info-circle';
                bgColor = 'bg-blue-500';
                textColor = 'text-white';
        }

        const notification = document.createElement('div');
        notification.id = 'custom-notification';
        notification.className = `fixed top-4 right-4 ${bgColor} ${textColor} px-6 py-3 rounded-lg shadow-lg z-50 flex items-center animate__animated animate__fadeInRight`;
        notification.setAttribute('role', 'status');
        notification.setAttribute('aria-live', 'polite');
        notification.innerHTML = `
            <i class="${icon} mr-2" aria-hidden="true"></i>
            <span>${message}</span>
        `;

        document.body.appendChild(notification);

        setTimeout(() => {
            notification.classList.remove('animate__fadeInRight');
            notification.classList.add('animate__fadeOutRight');
            setTimeout(() => {
                notification.remove();
            }, 500);
        }, 3000);
    }

    function formatDisplayDateTime(dateTimeStr) {
        if (!dateTimeStr) return "";
        try {
            const date = new Date(dateTimeStr);
            if (isNaN(date.getTime())) return dateTimeStr;

            const year = date.getFullYear();
            const month = ('0' + (date.getMonth() + 1)).slice(-2);
            const day = ('0' + date.getDate()).slice(-2);
            const hours = ('0' + date.getHours()).slice(-2);
            const minutes = ('0' + date.getMinutes()).slice(-2);
            return `${year}-${month}-${day} ${hours}:${minutes}`;
        } catch (e) {
            console.error("格式化日期失败:", dateTimeStr, e);
            return dateTimeStr;
        }
    }

    function getQuestionTypeDisplay(type) {
        switch (type) {
            case 'single_choice':
                return '单选题';
            case 'multiple_choice':
                return '多选题';
            case 'fill_blank':
                return '填空题';
            case 'essay':
                return '问答题';
            default:
                return type || '未知';
        }
    }

    function getDifficultyDisplay(difficulty) {
        switch (difficulty) {
            case 'easy':
                return {text: '简单', class: 'status-easy'};
            case 'medium':
                return {text: '中等', class: 'status-medium'};
            case 'hard':
                return {text: '困难', class: 'status-hard'};
            default:
                return {text: difficulty || '未知', class: ''};
        }
    }

    function loadStudents() {
        $("#loading-students-message").show();
        $("#no-students-data-message").hide();
        $("#student-list").empty();

        for (let i = 0; i < 5; i++) {
            $("#student-list").append(`
                <tr>
                    <td colspan="8" class="py-4">
                        <div class="shimmer w-full h-10 rounded-md"></div>
                    </td>
                </tr>
            `);
        }

        $.get("/Anotherview/api/adminInfo", {action: "getStudents"}, function (response) {
            $("#student-list").empty();
            $("#loading-students-message").hide();
            if (response.success && response.students && response.students.length > 0) {
                allStudentsData = response.students;
                renderStudents(allStudentsData);
            } else {
                $("#no-students-data-message").show();
            }
        }).fail((xhr, status, error) => {
            $("#student-list").empty();
            $("#loading-students-message").hide();
            $("#no-students-data-message").show().find('p').text('加载学生数据失败。');
            showNotification('加载学生数据失败: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText), "error");
            console.error("Error loading students:", error, xhr.responseText);
        });
    }

    function renderStudents(students) {
        const $studentListTbody = $("#student-list");
        $studentListTbody.empty();

        if (!students || students.length === 0) {
            $("#no-students-data-message").show();
            return;
        } else {
            $("#no-students-data-message").hide();
        }

        const nameFilter = $('#student-name-filter').val().toLowerCase();
        const numberFilter = $('#student-number-filter').val().toLowerCase();
        const classFilter = $('#student-class-filter').val().toLowerCase();
        const searchTerm = $("#student-search-input").val().trim().toLowerCase();

        let filteredStudents = students.filter(student => {
            const matchesName = nameFilter === '' || (student.name && student.name.toLowerCase().includes(nameFilter));
            const matchesNumber = numberFilter === '' || (student.studentNumber && student.studentNumber.toLowerCase().includes(numberFilter));
            const matchesClass = classFilter === '' || (student.classof && student.classof.toLowerCase().includes(classFilter));
            const matchesSearch = searchTerm === '' ||
                (student.name && student.name.toLowerCase().includes(searchTerm)) ||
                (student.studentNumber && student.studentNumber.toLowerCase().includes(searchTerm)) ||
                (student.email && student.email.toLowerCase().includes(searchTerm)) ||
                (student.school && student.school.toLowerCase().includes(searchTerm)) ||
                (student.classof && student.classof.toLowerCase().includes(searchTerm));
            return matchesName && matchesNumber && matchesClass && matchesSearch;
        });

        filteredStudents.forEach((student, index) => {
            const row = $(`
                <tr class="border-b border-gray-200 hover:bg-blue-50" data-student-id="${student.id}">
                    <td class="py-3 px-6 text-left font-semibold">${student.id || 'N\A'}</td>
                    <td class="py-3 px-6 text-left">${student.studentNumber || 'N\A'}</td>
                    <td class="py-3 px-6 text-left">${student.name || 'N\A'}</td>
                    <td class="py-3 px-6 text-left">${student.email || 'N\A'}</td>
                    <td class="py-3 px-6 text-left">${student.school || 'N\A'}</td>
                    <td class="py-3 px-6 text-left">${student.classof || 'N\A'}</td>
                    <td class="py-3 px-6 text-left" id="student-${student.id}-lessons">加载中...</td>
                    <td class="py-3 px-6 text-left">
                        <button onclick="openEnrollCoursesModal(${student.id}, '${student.name}')"
                                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-3 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all">
                            <i class="fas fa-book-reader mr-1"></i>选课
                        </button>
                    </td>
                </tr>
            `);
            $studentListTbody.append(row);
            setTimeout(() => row.addClass('fade-in'), index * 50);

            loadAssociatedLessonsForStudent(student.id);
        });
    }

    function loadAssociatedLessonsForStudent(studentId) {
        const $lessonCell = $(`#student-${studentId}-lessons`);
        $lessonCell.html('<span class="text-gray-500">加载中...</span>');
        console.log(`Fetching associated lessons for student ID: ${studentId}`);

        $.get("/Anotherview/api/adminInfo", {action: "getStudentLessons", studentId: studentId}, function (response) {
            console.log(`Response for student ${studentId} associated lessons:`, response);
            if (response.success && response.associatedLessonIds && response.associatedLessonIds.length > 0) {
                const associatedLessonNames = response.associatedLessonIds.map(lessonId => {
                    const lessonTitle = allLessonsMap.get(lessonId);
                    if (!lessonTitle) {
                        console.warn(`Lesson ID ${lessonId} not found in allLessonsMap for student ${studentId}.`);
                        return `ID: ${lessonId} (未知课程)`;
                    }
                    return lessonTitle;
                }).join(', ');
                $lessonCell.attr('title', associatedLessonNames).text(associatedLessonNames);
            } else {
                $lessonCell.attr('title', '未选课').text('未选课');
            }
        }).fail((xhr, status, error) => {
            $lessonCell.attr('title', '加载失败').text('加载失败');
            console.error(`Failed to load associated lessons for student ID: ${studentId}`, error, xhr.responseText);
            showNotification(`加载学生 ${studentId} 的已选课程失败。`, "error");
        });
    }


    function openEnrollCoursesModal(studentId, studentName) {
        currentStudentIdForLessonEnrollment = studentId;
        $("#enroll-courses-modal-title").text(`为学生 "${studentName}" 选课`);
        $("#enroll-courses-student-id").val(studentId);
        const $lessonList = $("#modal-lesson-list");
        $lessonList.empty();
        $lessonList.html(`
            <div class="loader mb-3" role="status" aria-label="加载中"></div>
            <p class="text-center text-gray-500">正在加载课程列表...</p>
        `);
        $("#enroll-courses-modal-save-btn").prop('disabled', true);

        if (allLessonsData.length === 0) {
            console.warn("allLessonsData is empty when opening enroll courses modal. Attempting to reload lessons.");
            $.when(loadLessons()).done(function() {
                openEnrollCoursesModalLogic(studentId, studentName);
            }).fail(function() {
                $lessonList.html('<p class="text-center text-red-500"><i class="fas fa-exclamation-circle mr-1"></i>加载课程列表失败，请刷新页面重试。</p>');
                $("#enroll-courses-modal-save-btn").prop('disabled', true);
                showNotification("加载课程列表失败，无法进行选课操作。", "error");
            });
        } else {
            openEnrollCoursesModalLogic(studentId, studentName);
        }
    }

    function openEnrollCoursesModalLogic(studentId, studentName) {
        const $lessonList = $("#modal-lesson-list");
        $lessonList.empty();

        $.get("/Anotherview/api/adminInfo", {action: "getStudentLessons", studentId: studentId})
            .done(function(associatedLessonsResponse) {
                const currentLessonIds = associatedLessonsResponse.success && associatedLessonsResponse.associatedLessonIds ? associatedLessonsResponse.associatedLessonIds : [];

                if (allLessonsData.length === 0) {
                    $lessonList.html('<p class="text-gray-600 text-center">没有可用课程。</p>');
                    $("#enroll-courses-modal-save-btn").prop('disabled', true);
                } else {
                    allLessonsData.forEach(lesson => {
                        const isChecked = currentLessonIds.includes(lesson.id) ? 'checked' : '';
                        const semesterName = allSemestersMap.get(lesson.semesterId) || '未知学期';
                        $lessonList.append(`
                        <label class="inline-flex items-center mt-3 p-2 rounded-md hover:bg-blue-50 cursor-pointer transition-all w-full">
                            <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600" name="selectedLessons" value="${lesson.id}" ${isChecked}>
                            <span class="ml-2 text-gray-700">${lesson.title} (${semesterName})</span>
                        </label>
                    `);
                    });
                    $("#enroll-courses-modal-save-btn").prop('disabled', false);
                }
            }).fail(function(xhr, status, error) {
            $lessonList.html('<p class="text-center text-red-500"><i class="fas fa-exclamation-circle mr-1"></i>加载课程列表失败。</p>');
            $("#enroll-courses-modal-save-btn").prop('disabled', true);
            console.error(`Failed to load associated lessons for student ${studentId} in modal:`, error, xhr.responseText);
            showNotification(`加载学生 ${studentId} 的已选课程失败，请检查网络或刷新页面。`, "error");
        });

        $("#enroll-courses-modal").removeClass("hidden").addClass("flex");
    }

    function closeEnrollCoursesModal() {
        $("#enroll-courses-modal").removeClass("flex").addClass("hidden");
        currentStudentIdForLessonEnrollment = null;
    }

    function saveStudentCourses() {
        const studentId = $("#enroll-courses-student-id").val();
        const selectedLessonIds = $('input[name="selectedLessons"]:checked').map(function () {
            return $(this).val();
        }).get();

        showNotification("正在保存选课信息...", "info");
        $("#enroll-courses-modal-save-btn").prop('disabled', true);

        $.post("/Anotherview/api/adminInfo", {
            action: "updateStudentLessons",
            studentId: studentId,
            lessonIds: selectedLessonIds.join(',')
        }, function (response) {
            console.log("Save student courses response:", response);
            if (response.success) {
                showNotification("选课信息更新成功！", "success");
                closeEnrollCoursesModal();
                loadStudents();
            } else {
                showNotification("选课信息更新失败: " + response.message, "error");
            }
            $("#enroll-courses-modal-save-btn").prop('disabled', false);
        }).fail((xhr) => {
            showNotification('选课信息更新失败: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText), "error");
            $("#enroll-courses-modal-save-btn").prop('disabled', false);
            console.error("Error saving student courses:", xhr.responseText);
        });
    }

    $(document).ready(function () {
        animateEntranceSequence();

        $.when(
            loadAllClasses(),
            loadAllTeachers(),
            loadSemesters(),
            loadLessons()
        ).done(function () {
            $.get("/Anotherview/api/adminInfo", function (response) {
                if (response.success && response.admin) {
                    const admin = response.admin;
                    $("#username").text(admin.name);
                    $("#dashboard-admin-name").text(admin.name);
                    showNotification("管理员信息加载成功！", "success");
                    navigateTo('dashboard');
                } else {
                    showNotification("无法获取管理员信息，请重新登录", "error");
                    setTimeout(() => {
                        window.location.href = "/Anotherview/html/admin/admin-login.html";
                    }, 2000);
                }
            }).fail((xhr) => {
                const errorMessage = xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText || "未知错误";
                showNotification("无法获取管理员信息: " + errorMessage + "，请重新登录", "error");
                setTimeout(() => {
                    window.location.href = "/Anotherview/html/admin/admin-login.html";
                }, 2000);
            });
        }).fail(function (error) {
            console.error("Error loading initial data:", error);
            showNotification("初始化数据加载失败，部分功能可能受限。", "error");
        });


        $("#question-type-filter, #question-difficulty-filter").on('change', function () {
            loadQuestions();
        });

        $("#question-search-input").on('input', function () {
            clearTimeout(this.searchTimer);
            this.searchTimer = setTimeout(() => {
                loadQuestions();
            }, 300);
        });

        $("#lesson-id-filter").on('input', function () {
            clearTimeout(this.lessonIdTimer);
            this.lessonIdTimer = setTimeout(() => {
                loadQuestions();
            }, 300);
        });

        $("#teacher-name-filter, #teacher-email-filter").on('input', function () {
            clearTimeout(this.filterTimer);
            this.filterTimer = setTimeout(() => {
                renderTeachers(allTeachersData);
            }, 300);
        });

        $("#teacher-search-input").on('input', function () {
            clearTimeout(this.searchTimer);
            this.searchTimer = setTimeout(() => {
                renderTeachers(allTeachersData);
            }, 300);
        });

        $("#lesson-title-filter, #lesson-teacher-filter, #lesson-semester-filter").on('input', function () {
            clearTimeout(this.filterTimer);
            this.filterTimer = setTimeout(() => {
                renderLessons(allLessonsData);
            }, 300);
        });

        $("#lesson-search-input").on('input', function () {
            clearTimeout(this.searchTimer);
            this.searchTimer = setTimeout(() => {
                renderLessons(allLessonsData);
            }, 300);
        });

        $("#student-name-filter, #student-number-filter, #student-class-filter").on('input', function () {
            clearTimeout(this.filterTimer);
            this.filterTimer = setTimeout(() => {
                renderStudents(allStudentsData);
            }, 300);
        });

        $("#student-search-input").on('input', function () {
            clearTimeout(this.searchTimer);
            this.searchTimer = setTimeout(() => {
                renderStudents(allStudentsData);
            }, 300);
        });


        $(".sidebar-button").removeClass("active").attr("aria-current", "false");
        $('.sidebar-button').each(function () {
            if ($(this).attr('onclick').includes("navigateTo('dashboard')")) {
                $(this).addClass('active').attr("aria-current", "page");
            }
        });
    });
</script>

</body>
</html>
